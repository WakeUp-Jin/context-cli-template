# æ¶æ„è®¾è®¡ - ä¸Šä¸‹æ–‡å·¥ç¨‹

## ä¸€ã€æ€»è®¾è®¡
![image (42)](https://img.j8.je/images/2025/12/08/cCmb.webp)
æ•´ä¸ªåç«¯æ¶æ„è®¾è®¡ä¸­ï¼Œæ˜¯æŒ‰ç…§ä¸Šä¸‹æ–‡å·¥ç¨‹æ¥åšçš„è®¾è®¡ï¼Œä¸Šä¸‹æ–‡ç®¡ç†æ˜¯æ ¸å¿ƒï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„å¤§è¾“å…¥ï¼Œä»¥æ­¤è¾“å…¥ä½œä¸ºå‰æï¼Œæ¥è§£å†³ç”¨æˆ·çš„é—®é¢˜

1. LLM æ¨¡å—ï¼šæ˜¯ä½¿ç”¨ **openaiSDK** æ¥å®ç°çš„å¤šç§å‹å·æ¨¡å‹çš„ä½¿ç”¨ï¼Œè¿™é‡Œæ˜¯æä¾›æ¨¡å‹çš„
2. å·¥å…·æ¨¡å—å’Œç®¡ç†ï¼šå·¥å…·æ˜¯ LLM å…³é”®çš„å¤–éƒ¨èƒ½åŠ›ï¼Œæ˜¯ç»“åˆåˆ°ä¸Šä¸‹æ–‡æ¥è®© LLM ä½¿ç”¨çš„
3. ä¸Šä¸‹æ–‡ç®¡ç†ï¼šè¿™ä¸ªæ˜¯ç»Ÿä¸€çš„ä¸Šä¸‹æ–‡ï¼Œå…¶è´Ÿè´£ç¼–æ’å¥½ä¸Šä¸‹æ–‡ï¼Œåœ¨ æ‰§è¡Œå™¨ä¸­å°†ä¸Šä¸‹æ–‡è¾“å…¥ç»™ LLMï¼Œä»¥ LLM çš„è¾“å‡ºæ¥è§£å†³é—®é¢˜

## äºŒã€LLM æ¨¡å—
![image (43)](https://img.j8.je/images/2025/12/08/cCR7.webp)

å…³äº LLM æ¨¡å—ï¼Œæ•´ä¸ªæ¨¡å—çš„åˆ†ä¸ºï¼š

+ LLM åˆ›å»ºå·¥å‚å‡½æ•°ï¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥åˆ¤æ–­å®ä¾‹åŒ–å“ªä¸€ä¸ª LLM æœåŠ¡ç±»
+ LLM æœåŠ¡ç±»ï¼šè¦ç¼–å†™ä¸€ä¸ªç›¸åº”çš„ LLM æœåŠ¡ç±»ï¼Œé‡Œé¢æœ‰ä¸‰ç§æ–¹æ³•ï¼šcomplete æ–¹æ³•ã€simpleChat æ–¹æ³•ã€generate æ–¹æ³•ï¼Œå…¶ä¸­æœ€é‡è¦çš„æ˜¯ complete æ–¹æ³•ï¼Œè¿™ä¸ªä¼šä½œä¸ºä¸Šä¸‹æ–‡è¾“å…¥çš„æ ¸å¿ƒæ–¹æ³•



ç›®å½•æƒ…å†µç»“æ„ï¼š

```plain
- llm
  - services
    - DeepSeekService.ts // è¿™ä¸ªå°±æ˜¯å…·ä½“çš„LLMæœåŠ¡ç±»
    - DoubaoService.ts
  - utils
  - types
    - index.ts //è¿™ä¸ªæ˜¯æ•´ä¸ªllmæ¨¡å—çš„ç±»å‹çº¦æŸ
  - factory.ts //LLMå·¥å‚å‡½æ•°
  - index.ts
```



ä¸¾ä¸€ä¸ªä¾‹å­ï¼š

```typescript
//å…·ä½“ä½¿ç”¨

//1ã€ä½¿ç”¨å·¥å‚å‡½æ•°å®ä¾‹åŒ–ç›¸åº”çš„LLMç±»
const service = await createLLMService({
  provider: 'deepseek',
  model: 'deepseek-chat',
  apiKey: process.env.DEEPSEEK_API_KEY || 'your-api-key-here',
  maxIterations: 5,
});

//2ã€è°ƒç”¨simpleChatæ–¹æ³•
const answer = await service.simpleChat(
  'ç”¨ä¸€å¥è¯è§£é‡Šä»€ä¹ˆæ˜¯å¤§è¯­è¨€æ¨¡å‹ï¼Ÿ',
  'ä½ æ˜¯ä¸€ä¸ªæœ‰å¸®åŠ©çš„ AI åŠ©æ‰‹'
);

//3ã€è°ƒç”¨completeæ–¹æ³•
let message=[//...]
let tools=[//...]
const response=await service.complete(message,tools)

```


## ä¸‰ã€å·¥å…·æ¨¡å—å’Œç®¡ç†
![image (44)](https://img.j8.je/images/2025/12/08/cCPl.webp)

å·¥å…·æ¨¡å—ä¸»è¦çš„ä¸‰ä¸ªç‚¹å°±æ˜¯ï¼š

1. å·¥å…·çš„å®šä¹‰ï¼šå®šä¹‰ä¸€ä¸ªå·¥å…·å¯¹è±¡éœ€è¦å“ªäº›å±æ€§
2. æä¾›ç»™ LLM å·¥å…·å‚æ•°ï¼šå¯ä»¥æ˜¯ tools å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯æç¤ºè¯æ–‡æœ¬
3. å·¥å…·çš„æ‰§è¡Œå‡½æ•°ï¼šå·¥å…·çš„æ‰§è¡Œå‡½æ•°



**ç›®å½•ç»“æ„ï¼š**

```plain
- tool
  - FileReadTool
    - FileReadTool.ts //å·¥å…·å®šä¹‰
    - prompt.ts //å·¥å…·æè¿°
  - GrepTool
    - GrepTool.ts
    - prompt.ts
  - index.ts
  - ToolManager.ts //å·¥å…·ç®¡ç†å‡½æ•°
  - types.ts //å·¥å…·æ¨¡å—çš„ç±»å‹
```



**1ã€ å·¥å…·å®šä¹‰**

```typescript
/**
 * å·¥å…·å®šä¹‰åŸºç¡€æ¥å£
 */
export interface InternalTool<TArgs = any, TResult = any> {
  /** å·¥å…·åç§°(å”¯ä¸€æ ‡è¯†) */
  name: string;

  /** å·¥å…·åˆ†ç±»(å¦‚ filesystemã€searchã€network) */
  category: string;

  /** æ˜¯å¦ä¸ºå†…éƒ¨å·¥å…· */
  internal: boolean;

  /** å·¥å…·æè¿°(ç®€çŸ­,è¯¦ç»†æè¿°åœ¨ prompt ä¸­) */
  description: string;

  /** ç‰ˆæœ¬å· */
  version: string;

  /** å‚æ•°å®šä¹‰(JSON Schema æ ¼å¼) */
  parameters: ToolParameterSchema;

  /** å·¥å…·å¤„ç†å‡½æ•° */
  handler: (args: TArgs, context?: InternalToolContext) => Promise<TResult>;

  /** å¯é€‰:æ ¼å¼åŒ–ç»“æœç»™ AI */
  renderResultForAssistant?: (result: TResult) => string;

  /** å¯é€‰:æƒé™æ§åˆ¶ */
  needsPermissions?: (input?: TArgs) => boolean; // æ˜¯å¦éœ€è¦æƒé™
  isEnabled?: () => Promise<boolean>; // æ˜¯å¦å¯ç”¨
  isReadOnly?: () => boolean; // æ˜¯å¦åªè¯»
  isConcurrencySafe?: () => boolean; // æ˜¯å¦å¹¶å‘å®‰å…¨
}
```



ä¾‹å¦‚ï¼š

```typescript
//1ã€åˆ›å»ºå·¥å…·ç®¡ç†å™¨
const toolManager = new ToolManager();

//2ã€è·å–å·¥å…·å®šä¹‰
const tools = toolManager.getTools();

//3ã€åˆ›å»ºLLMæœåŠ¡
const llm = await createLLMService(
  {
    provider: 'deepseek',
    model: 'deepseek-chat',
    apiKey: config.apiKey || '',
    maxIterations: 5,
  },
  tools
);

//4ã€è°ƒç”¨å·¥å…·æ‰§è¡Œå‡½æ•°
const answer = await llm.generate(
  'è¯·å¸®æˆ‘è¯»å– package.json æ–‡ä»¶ï¼Œå¹¶å‘Šè¯‰æˆ‘é¡¹ç›®åç§°æ˜¯ä»€ä¹ˆ'
);
```


## å››ã€ä¸Šä¸‹æ–‡ç®¡ç†
![image (45)](https://img.j8.je/images/2025/12/08/cCVk.webp)

åœ¨è¿™ç§ä¸Šä¸‹æ–‡ç®¡ç†è®¾è®¡ä¸­ï¼Œå°†è¯¥ Agent ä¸­æ‰€æœ‰ç§ç±»çš„ä¸Šä¸‹æ–‡ç®¡ç†ç»Ÿä¸€èµ·æ¥ï¼Œè®© LLM åªéœ€è¦ç›´æ¥å’Œä¸Šä¸‹æ–‡è¾“å…¥è”ç³»

:::warning
ğŸŒŸğŸŒŸ åœ¨è¿™ç§å¼€å‘æ¨¡å¼ä¸‹ï¼Œå¼€å‘çš„é‡å¿ƒåœ¨ä¸Šä¸‹æ–‡çš„è·å–å’Œæ•´ç†ï¼Œä½†æ˜¯åº”ç”¨çš„å…³é”®æ ¸å¿ƒæ˜¯ LLMã€‚

+ ä¿è¯æ ¸å¿ƒæ˜¯ LLMï¼Œåç»­å°±å¯ä»¥æ ¹æ®æ¨¡å‹èƒ½åŠ›çš„æå‡ï¼ŒAgent çš„æ•ˆæœä¹Ÿå˜å¾—è¶Šæ¥è¶Šå¥½ã€‚
+ å¼€å‘é‡å¿ƒæ˜¯ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æå¤§çš„å‘æŒ¥åº”ç”¨å¼€å‘è€…çš„èƒ½åŠ›å’Œåˆ›é€ åŠ›

:::



**ç›®å½•ç»“æ„ï¼š**

```plain
- context
  - base
    - BaseContext.ts //åŸºç¡€ä¸Šä¸‹æ–‡ç±»
  - modules
    - ConversationContext.ts //ä¸Šä¸‹æ–‡ - ä¼šè¯å†å²è®°å½•ç±»
    - MemoryContext.ts //ä¸Šä¸‹æ–‡ - ç”¨æˆ·è®°å¿†ç±»
    - StructuredOutputContext.ts //ä¸Šä¸‹æ–‡ - ç»“æ„åŒ–è¾“å‡ºç±»
    - SystemPromptContext.ts //ä¸Šä¸‹æ–‡ - ç³»ç»Ÿæç¤ºè¯ç±»
    - ToolContext.ts  //ä¸Šä¸‹æ–‡ - å·¥å…·ç®¡ç†ç±»
  - ContextManager.ts //ä¸Šä¸‹æ–‡ç®¡ç†å™¨
  - index.ts
  - types.ts // ä¸Šä¸‹æ–‡ç®¡ç†æ¨¡å—çš„ç±»å‹çº¦æŸ
```

## äº”ã€æ‰§è¡Œå™¨
å•æ™ºèƒ½ä½“ä¸å¤šæ™ºèƒ½ä½“çš„æ¶æ„è®¾è®¡çš„åŒºåˆ«ï¼Œè¯¦ç»†å¯ä»¥æŸ¥çœ‹ï¼š
> https://github.com/WakeUp-Jin/Practical-Guide-to-Context-Engineering/blob/main/docs/Agent%E5%BD%A2%E6%80%81/%E6%99%BA%E8%83%BD%E4%BD%93%E7%B3%BB%E7%BB%9F%E6%9E%84%E5%BB%BA%E7%AD%96%E7%95%A5-%E5%8D%95%E6%99%BA%E8%83%BD%E4%BD%93%E5%92%8C%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93.md

## æœ€å
æœ¬æ–‡èŠ‚é€‰è‡ªæˆ‘æ­£åœ¨æ•´ç†çš„Â ã€Œä¸Šä¸‹æ–‡å·¥ç¨‹å®è·µã€Â é¡¹ç›®ï¼Œè¯¥é¡¹ç›®å·²å®Œæ•´å‘å¸ƒåœ¨ GitHub ä¸Šã€‚
å¦‚æœä½ å¸Œæœ›é˜…è¯»æ›´å¤šç›¸å…³çš„ç« èŠ‚ä¸æ¡ˆä¾‹ï¼Œå¯ä»¥å‰å¾€é¡¹ç›®ä»“åº“æŸ¥çœ‹ï¼š
> ğŸ‘‰ https://github.com/WakeUp-Jin/Practical-Guide-to-Context-Engineering

